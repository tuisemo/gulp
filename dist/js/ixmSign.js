$(function(){window.MSG={true:'<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>',false:'<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>',101:"以英文字母开头，可包含3-20个字符",102:"用户名格式不正确！",103:"该用户名已被占用！",104:"该账号不存在！",201:"请输入您的手机号(仅支持中国大陆)",202:"手机号码格式有误！",203:"该手机号已被占用！",301:"请输入您的邮箱地址",302:"请输入正确的邮箱地址！",303:"该邮箱已被占用！",401:"",402:"验证码过期或有误！",501:"8-30位字符包含数字和英文字符",502:"密码格式不符合，请重设！",503:"密码强度太弱，请重设！",504:"密码要求8-30位！",505:"两次密码不一致！",601:"校验码过期或有误！"}}),$(function(){var e=function(){this.$userName=$("#userName"),this.$Tel=$("input[type='tel']"),this.$validateCode=$("#validateCode"),this.$msgCode=$("#msgCode"),this.$codeimg=$("#codeimg"),this.$reloadBtn=$("#reloadBtn"),this.$Password=$(".password"),this.$FPassword=$("#FPassword"),this.$CPassword=$("#CPassword")};e.prototype={Opt:function(e){switch(e.code){case 200:break;case-1:this.$userName.parents(".form-group").addClass("has-error"),this.$userName.next(".help-block").html(MSG.false+e.result);break;case 1001:this.$userName.parents(".form-group").addClass("has-error"),this.$userName.next(".help-block").html(MSG.false+e.result);break;case 1002:this.$userName.parents(".form-group").addClass("has-error"),this.$userName.next(".help-block").html(MSG.false+e.result);break;case 1003:this.$userName.parents(".form-group").addClass("has-error"),this.$userName.next(".help-block").html(MSG.false+e.result);break;case 2001:this.$Tel.parents(".form-group").addClass("has-error"),this.$Tel.next(".help-block").html(MSG.false+e.result);break;case 2002:this.$Tel.parents(".form-group").addClass("has-error"),this.$Tel.next(".help-block").html(MSG.false+e.result);break;case 2003:this.$Tel.parents(".form-group").addClass("has-error"),this.$Tel.next(".help-block").html(MSG.false+e.result);break;case 2005:this.$Tel.parents(".form-group").addClass("has-error"),this.$Tel.next(".help-block").html(MSG.false+e.result);break;case 3001:this.$Tel.parents(".form-group").addClass("has-error"),this.$Tel.next(".help-block").html(MSG.false+e.result);break;case 3002:this.$Tel.parents(".form-group").addClass("has-error"),this.$Tel.next(".help-block").html(MSG.false+e.result);break;case 3003:this.$Tel.parents(".form-group").addClass("has-error"),this.$Tel.next(".help-block").html(MSG.false+e.result);break;case 3005:this.$Tel.parents(".form-group").addClass("has-error"),this.$Tel.next(".help-block").html(MSG.false+e.result);break;case 4004:this.$validateCode.parents(".form-group").addClass("has-error"),this.$validateCode.next(".help-block").html(MSG.false+e.result);break;case 4006:this.$validateCode.parents(".form-group").addClass("has-error"),this.$validateCode.next(".help-block").html(MSG.false+e.result);break;default:this.$msgCode.addClass("text-danger").html(MSG.false+e.result)}}},window.ResultOpt=new e}),$(function(){var e=function(){this.wait=10,this.timeBoo=!0,this.$userName=$("#userName"),this.$Tel=$("input[type='tel']"),this.$validateCode=$("#validateCode"),this.$msgCode=$("#msgCode"),this.$codeimg=$("#codeimg"),this.$reloadBtn=$("#reloadBtn"),this.$Password=$(".password"),this.$FPassword=$("#FPassword"),this.$CPassword=$("#CPassword"),this.$SubmitBtn=$("#submit"),this.$Check=$("#check"),this.init()};e.prototype={init:function(){this.listen()},listen:function(){var e=this;e.$userName.on("blur",function(){e.checkuserName()}),e.$userName.on("focus",function(){e.removeClass($(this)),$(this).next(".help-block").html(MSG[101])}),e.$Tel.on("blur",function(){e.checkTel()}),e.$Tel.on("focus",function(){e.removeClass($(this)),$(this).next(".help-block").html(MSG[201])}),e.$validateCode.on("focus",function(){e.removeClass($(this)),$(this).next(".help-block").html(MSG[401])}),e.$codeimg.on("click",function(){e.reloadvalidate($(this))}),e.$reloadBtn.on("click",function(){e.reloadvalidate($(this))}),e.$FPassword.on("blur",function(){e.checkpassword()}),e.$CPassword.on("blur",function(){e.confirmpwd()}),e.$Password.on("focus",function(){e.removeClass($(this)),$(this).next(".help-block").html(MSG[501])}),e.$SubmitBtn.on("click",function(){e.SignUp()})},optMsg:function(e,s,t){s===!0?(e.parents(".form-group").addClass("has-success"),e.next(".help-block").html(MSG.true)):(e.parents(".form-group").addClass("has-error"),e.next(".help-block").html(MSG.false+MSG[t]))},removeClass:function(e){e.parents(".form-group").removeClass("has-success has-warring has-error")},Timesetter:function(e){var s=this;0===s.wait?($("#msgtimer").html("发送校验码"),$("#sendmsg").show(),$("#msgtimer").hide(),s.wait=10,s.timeBoo=!0):(10==s.wait&&($("#sendmsg").hide(),$("#msgtimer").show()),s.timeBoo=!1,$("#msgtimer").html(s.wait+"秒后再重试"),s.wait--,setTimeout(function(){s.Timesetter(e)},1e3))},checkuserName:function(){var e=this,s=e.$userName.val();/^[a-zA-Z][a-zA-Z0-9_]{2,19}$/.test(s)||e.optMsg(e.$userName,!1,"102")},checkTel:function(){var e=this,s=e.$Tel.val();/^((13[0-9])|(14[0-9])|(15[0-9])|(17[2-9])|(18[0-9]))\d{8}$/.test(s)&&11==s.length||e.optMsg(e.$Tel,!1,202)},reloadvalidate:function(){var e=this;e.$validateCode.val(""),e.$codeimg.attr("src","http://www.ixm.gov.cn/dis/passport/authCode/show?"+Math.random()),validateTrue=!1},checkpassword:function(){var e=this,s=e.$FPassword.val();/[A-Za-z].*[0-9]|[0-9].*[A-Za-z]/.test(s)?s.length<8||s.length>30?e.optMsg(e.$FPassword,!1,502):$.ajax({url:"/api/checkUserPwd",type:"GET",dataType:"text",cache:!1,data:{userName:e.$userName.val()||"",password:e.$FPassword.val()},success:function(s){s.indexOf("success")!=-1?e.optMsg(e.$FPassword,!0):e.optMsg(e.$FPassword,!1,503)}}):e.optMsg(e.$FPassword,!1,502)},confirmpwd:function(){var e=this;e.$FPassword.val()!=e.$CPassword.val()&&(e.optMsg(e.$FPassword,!1,505),e.optMsg(e.$CPassword,!1,505))},sendMsgFor:function(e,s,t){var a=this,r=$("#TelOrEmail").val(),o=$("#validateCode").val();if(a.timeBoo===!1)return!1;$.ajax({url:"/dis/passport/sendMsg",dataType:"json",async:!0,cache:!1,data:{operationType:e,domainName:s,sendType:t,mobile:r,code:o},type:"POST",success:function(e){if(200==e.code)return $("#msgtimer").hide(),$("#sendmsg").show(),$("#mobilemsg").addClass("text-success").html(MSG.true+e.result),void a.Timesetter();ResultOpt.Opt(e)},error:function(e){return $("#codemsg").addClass("text-danger").html(MSG.false+"请求出错请重试！"),!1}})},SignUp:function(){var e=this;if(e.$Check.is(":checked")){var s=e.$userName.val()+";"+e.$Tel.val();$.ajax({url:"/api/checkUserAttribute",dataType:"json",async:!0,data:{attributeValue:s,attributeName:"userName;mobile",domainName:"Citizen"},type:"POST"}).done(function(s){$.ajax({url:"/api/reg",type:"POST",dataType:"json",cache:!1,data:{userName:$(e.$userName).val()||"tuisemo",mobile:$(e.$Tel).val()||"18248639098",Code:$(e.$validateCode).val()||"resj",msgCode:$(e.$msgCode).val()||"234567",password:$(e.$CPassword).val()||"czp20mhkdurl"},success:function(e){200===e.code&&(window.location=""),ResultOpt.Opt(e)}})}).fail(function(e){console.log(e)})}}},window.CitizenSignUp=new e});